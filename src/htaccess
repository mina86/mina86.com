RewriteEngine On
RewriteBase "/"

# Old paths for post URLs and category indexes:
RewriteRule "^20[01][0-9]/[0-1][0-9]/[0-3][0-9]/(.*)/"     "p/$1/"          [L,R=permanent]
RewriteRule "^kategoria/([a-z-]*)/$"                       "c/$1/"          [L,R=permanent]

# Atom and RSS feeds.  Current code doesn’t have as much configuration as the
# old site so this flattens all of the feeds to a single format.
RewriteRule "^(atom|rss)/cat/([a-z]*)/"                    "c/$2/atom.xml"  [L,R=permanent]
RewriteRule "^(atom|rss)/(content|short)/(html/)?(\d*/)?"  "atom.xml"       [L,R=permanent]

# In retrospect, I’m not sure if it was worth renaming from ‘files’ to ‘d’.
RewriteRule "^files/(.*)"                                  "d/$1"           [L,R=permanent]

# /sid/<code>/… is the way Jogger used to handle logged in users.  I’m
# still getting requests like that so for the transition period,
# redirect them to proper URLs.
RewriteRule "^sid/[a-z0-9A-Z]*/(.*)$"                      "$1"             [L,R=permanent]

# Icons
RewriteCond "%{DOCUMENT_ROOT}/d/$1" -f
RewriteRule "^(?:apple-)?touch-icon-[0-9]+x([0-9]+\.png)$" "d/$1"           [L,R=permanent]
RewriteRule "^(?:apple-)?touch-icon.png$"                  "d/192.png"      [L,R=temp]

# If browser supports gzip and we have compressed file, send it.
Options +MultiViews
DirectoryIndex index

# application/javascript is technically correct but HTML5 uses text/javascript
# as SCRIPT’s default TYPE so let’s stick to that.
AddType text/javascript .js

# Atom is the only thing .xml is used on the site so we might just as well use
# proper content type for it.
AddType application/atom+xml .xml

# Images almost never change so set a long expiry.  CSS and JavaScript
# resources don’t change more frequent but still not that often;
# a week should be enough.  Finally, everything else (so namely HTML
# and feed files) may change rarely as well but it’s important that
# the change is picked up quickly (I can live with slightly outdated
# styles but user should see new posts as quickly as possible).
ExpiresActive On
ExpiresDefault "access plus 1 hour"
ExpiresByType text/css "access plus 1 week"
ExpiresByType text/javascript "access plus 1 week"
ExpiresByType image/* "access plus 1 month"
