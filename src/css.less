/*!github.com/mina86/mina86.com*/

/*
 * Classes:
 * - table.tb – add top and bottom border to each of table’s TBODY.
 * - .nb – no break
 * - .np – no print
 * - p.nt – a note with some meta information (special licensing information,
 *   note about series, etc.)  Set with smaller font.
 * - p.ig – an image at the top of some posts (most notably news articles) and
 *   attribution that follows it (two separate paragraphs which *must* follow
 *   each other).
 */

/* I need something which will automatically choose IDs and classes. */
/* id:  a     d e         j k       o p q r   t u v w x y z */
/* cls:     c   e     h   j k l m n o           u     x y   */

@head-id: #h;  /* Page header. */
@body-id: #b;  /* Page body (article text, comments, sidebar etc). */
@foot-id: #f;  /* Page footer. */

@main-id: #m;  /* Article, comments etc.  In other words, body sans sidebar. */
@side-id: #s;  /* Sidebar. */
@pin-cls: .v;  /* Sidebar pinned to the side. */

@wrap-cls: .w;  /* Wrapper DIV inside @head-id and @body-id elements which exists
                  to limit the ‘usable’ width. */

/* Header elements: */
/* Last links in header which are hidden when side bar is on the side. */
@hidden-links-cls: .d;

/* Main content elements: */
@pagination-cls: .p;  /* Pagination table. */
@qed-cls: .q;  /* Article is shown in its entirety. */
@byline-cls: .b;  /* Byline paragraph. */
@article-text-cls: .t;  /* Text of the article. */
@comments-id: #c;  /* Comments  (on pages which have comments). */

@meta-cls: .g;
@social-cls: .s;
@cats-and-tags-cls: .i;

/* Sidebar sections: */
@contact-id: #n;  /* Contact section in the sidebar. */
@categories-id: #l;  /* Categories section in the sidebar. */
@feed-icon-cls: .f;  /* Class for the feed icon */
@icons-id: #i;  /* Icons section at the bottom of the sidebar. */

/* Octo, the GitHub corner */
@octo-id: #g;
@octo-bg-cls: .z;
@octo-arm-cls: .a;

/* Generic stuff */
@right-align-cls: .r;


/* http://spencermortensen.com/articles/typographic-scale/
   ratio = 2, notes = 5 */
@tiny:     round(pow(2rem, -0.4), 2);
@small:    round(pow(2rem, -0.2), 2);
@normal:   1.00rem;
/*         one skipped */
@large:    round(pow(2rem,  0.4), 2);
/*         one skipped */
@huge:     round(pow(2rem,  0.8), 2);
@title:    2.00rem;

@cosmic-latte: #fff8e7;  /* https://en.wikipedia.org/wiki/Cosmic_latte */
@milky-way: #f9f1ff;  /* http://www.news.pitt.edu/milkywaycolor */

// @header-bg: #0844a2;  /* Average of /d/top-img.jpg */
// @bg: @cosmic-latte;
// @even-bg: @milky-way;
// @sidebar-bg: #fff;
// @footer-bg: @header-bg;
// @pre-bg: desaturate(@bg, 100%);

/* http://davidjohnstone.net/pages/lch-lab-colour-gradient-picker is quite
   useful. */

@head-bg: #0844a2;  /* Average colour of /d/top-img.jpg */
@body-bg: #e4f0ff;  /* L* = 95, same a* and b* as @head-bg */
@side-bg: #b6ccee;  /* Step between @head-bg and @body-bg. */
@pre-bg:  #f1f1f1;  /* c = 0, same L* and h as @body-bg */

@text-color: #333333;  /* L* = 20 */
@code-color: #004a17;  /* L* = 20 */

@import url('https://fonts.googleapis.com/css?family=Libre+Baskerville:400,400i,700|Ubuntu+Mono:400,400i,700|Ubuntu:400,400i,700&subset=latin-ext');

@body-font: 'Libre Baskerville', Georgia, Charter, Utopia, serif;
@mono-font: 'Ubuntu Mono', 'Liberation Mono', 'Courier New', monospace;  /* for <pre> */
@code-font: 'Ubuntu', Verdana, sans-serif;  /* for <code> and <kbd> */
@head-font: 'DejaVu Sans', Verdana, sans-serif;
@sidebar-width: 14em;
@content-width: 50em;
@octo-width: 4em;
@wrap-width: (@sidebar-width + @content-width);


.text-off-screen() {
	text-indent: 100%;
	white-space: nowrap;
	overflow: hidden;
}

.grayscale-on() {
	-webkit-filter: grayscale(1);
	filter: grayscale(1);
}

.grayscale-off() {
	-webkit-filter: none;
	filter: none;
}


* {
	box-sizing: border-box;
	margin: 0;
	padding: 0;
}


html, body {
	@media screen, projection, tv, handheld {
		color: @text-color;
		background: @body-bg;
	}
	font-family: @body-font;
	font-variant: common-ligatures oldstyle-nums proportional-nums;
	text-rendering: optimizelegibility;
	line-height: 1.5em;
}


/**** Page layout ****/

@media screen, projection, tv, handheld {
	html {
		height: 100%;
	}
	body {
		display: flex;
		flex-direction: column;
		min-height: 100%;
	}
	@{body-id} {
		flex: 1;
	}

	@{head-id} {
		height: 14em;
	}
	@{head-id} @{wrap-cls} {
		height: 100%;
	}

	@{main-id}, @{side-id} section {
		padding: 1em;
		max-width: @content-width;
		margin: 0 auto;
	}
	@{side-id} {
		padding-top: 1em;
		padding-bottom: 5em;
	}

	/* Annoyingly, this rule has to be specified here because if it goes
	   below where other sidebar rules are, the ‘background: none’ property
	   in @media just below won’t clear it. */

	@{side-id} {
		background: @side-bg;
	}

	@media (min-width: @wrap-width) {
		@{wrap-cls} {
			min-width: @wrap-width;
			width: 90%;
			max-width: (@wrap-width + 5em);
			margin: 0 auto;
		}

		@{main-id} {
			float: left;
			width: @content-width;
			max-width: @content-width;
		}

		@{main-id} @{wrap-cls} {
			padding: 0;
		}

		@{side-id} {
			float: right;
			width: @sidebar-width;
			background: none;
			padding: 0;
		}
		@{side-id}@{pin-cls} {
			position: fixed;
		}

		@{side-id} section {
			padding: 1em 0.5em;
		}

		@{body-id} {
			overflow: auto;
			padding-bottom: 5em;
		}

		/* Sticking those here helps with minification: */
		@{contact-id} li:first-child span { display: block; }
		@{head-id} li@{hidden-links-cls} { display: none; }
	}
}

@{side-id} {
	a img {
		.grayscale-on();
	}
	a:hover, a:focus, a:active {
		img {
			.grayscale-off();
		}
	}
}

/**** Links ****/

h1, h2, h3 {
	page-break-after: avoid;
	a, a:link, a:hover, a:active, a:focus, a:visited {
		color: inherit;
	}
}

a {
	text-decoration: none;
	color: #00f;
}
a:visited {
	color: #63c;
}
a:hover, a:focus, a:active {
	color: #09f;
	text-decoration: underline;
}


/**** Page header ****/

@{head-id} {
	background: @head-bg;
	font-family: @head-font;

	h1 {
		font-size: @title;
	}
	h1 span {
		font-variant: small-caps;
	}

	@media screen, projection, tv, handheld {
		background: @head-bg url(/d/top-img.jpg) no-repeat;
		background-size: cover;
		/* filter: brightness(1.2) blur(5px); */

		@{wrap-cls} {
			position: relative;
		}

		h1 {
			position: absolute;
			color: @body-bg;
			top: 20%;
			left: 2%;
		}

		nav {
			position: absolute;
			bottom: 20%;
			left: 2%;
		}

		li {
			display: inline-block;
			margin: 0.2em;
		}

		ul a, ul a:link, ul a:visited {
			display: inline-block;
			padding: 0.5em 1em;
			color: #333;
			font-weight: 700;
			white-space: nowrap;
			background: #fff;
			background: rgba(255, 255, 255, 0.5);
			text-decoration: none;
			border-radius: 0.3em;
		}

		ul a:hover, ul a:active, ul a:focus {
			color: #00f;
			background: -webkit-linear-gradient(bottom, #cff, rgba(255, 255, 255, 0.4));
			background: -moz-linear-gradient(bottom, #cff, rgba(255, 255, 255, 0.4));
			background: -o-linear-gradient(bottom, #cff, rgba(255, 255, 255, 0.4));
			background: rgba(255, 255, 255, 0.4);
			text-shadow: #000 0.5em 0.5em 1em;
		}

		/* Google Search */
		#___gcse_0 {
			position: absolute;
			top: 1em;
			right: 0;
			width: 50%;
			* {
				box-sizing: content-box;
			}
		}
		.cse .gsc-control-cse,
		.gsc-control-cse,
		form.gsc-search-box,
		table.gsc-search-box {
			background: transparent;
			border: none;
			padding: 0;
			margin: 0;
		}
	}

	nav, #___gcse_0 {
		&:extend(.np);
	}
}


/**** Main content, text of the article and such ****/

article {
	padding: 2em 0;
	position: relative;

	& + &:before {
		content: '';
		position: absolute;
		top: 0;
		left: 15%;
		width: 70%;
		height: 0;
		border-top: 1px solid mix(@body-bg, #000, 80%);
	}

	p, dd, li {
		text-align: justify;
		hanging-punctuation: first allow-end last;
		hyphens: auto;
	}

	p {
		margin: 1rem 0;
	}

	@media screen, projection, tv, handheld {
		text-shadow: 1px 1px 0 #D9D9E6;;
	}
}

/* Links */
@{article-text-cls} {
	a {
		border-bottom: 1px dotted #99f;
	}

	a:hover, a:focus, a:active {
		text-decoration: none;
		border-bottom-style: solid;
		borter-bottom-color: #09f;
	}
}

/* Headers */
article {
	h1, h2, h3 {
		margin: 1rem 0;
		a, a:hover, a:focus, a:active {
			border: none;
		}
	}
	h1 {
		font-size: @huge;
		font-style: italic;
		margin-top: 0;
	}
	h2 {
		font-size: @large;
		margin-top: 2rem;
	}
	h3 {
		font-size: @normal;
	}
}

/* Byline etc */
p@{byline-cls} {
	font-style: italic;
	font-weight: 300;
	color: #666;
	page-break-before: avoid;
	page-break-after: avoid;
}

p.nt {
	font-size: @tiny;
	margin-left: 30%;
	text-align: left;
	hyphens: manual;
	font-style: italic;
}

p.ig, figure {
	text-align: center;
	img {
		max-width: 100%;
		height: auto;
	}
}
p.ig + p.ig {
	text-align: right;
	margin-top: -1em;
	font-size: @tiny;
	page-break-before: avoid;
}

/* Code */
pre, code, kbd {
	font-family: @code-font;
	font-variant: lining-nums slashed-zero;
	color: @code-color;
	text-shadow: none;
	page-break-inside: avoid;
	hyphens: manual;
}
pre {
	font-family: @mono-font;
	margin: 1rem;
	overflow-x: auto;
	font-size: @small;
	i {
		font-style: regular;
		font-family: @body-font;
	}
}

@media screen, projection, tv, handheld {
	@{qed-cls} @{article-text-cls} > p:last-child:after {
		color: #999;
		font-size: @tiny;
		content: ' -30-';
	}
}

/* Lists */
@{article-text-cls} {
	ul, ol, dl {
		margin: 1em 0;
	}
	li {
		margin: 0 0 0 2em;
		/* Less' data-uri is way over-zealous when URL encoding data
		   URIs which is why I’m sticking to my own. */
		list-style: url(DATA<dot.svg>);
	}
	dt, dd {
		padding: 0;
		margin-top: .25em;
	}
	dd {
		margin-left: 1.59em;
	}
	dd + dt {
		margin-top: 1em;
	}
}

/* Tables */
/* Putting this outside of @{article-text-cls} breaks Google custom search
   whose layout is based on tables.  *sighs* */
@{article-text-cls} {
	table, tr, th, td {
		font-variant: lining-nums tabular-nums;
		border-collapse: collapse;
	}
	th, td {
		padding: 0.5em;
	}
	thead th, thead td {
		padding: 0.2em 0.5em;
	}
	table {
		font-variant-numeric: tabular-nums;
		margin: 1em auto;
	}
	thead, .tb tbody, tfoot {
		border-top: 1px solid #000;
		border-bottom: 1px solid #000;
	}
	.tb tbody:last-child {
		border: none;
	}
}

blockquote, @{feed-icon-cls} span, @{icons-id} a {
	background: url(DATA<sprites.png>) no-repeat;
}

/* Misc */
blockquote {
	background-position: -69px 0;
	min-height: 20px;
	padding: 0 30px;
	margin: 1em;
	font-size: @small;

	p, dd, li {
		text-align: left;
		hyphens: manual;
	}
}

/* Meta information, social etc. */
@{meta-cls} {
	overflow: auto;
	page-break-inside: avoid;
	margin-top: 2em;
	font-style: italic;
}
@{meta-cls} > ul {
	float: left;
}
@{meta-cls} > ul li {
	margin-bottom: 0.5em;
}
@{meta-cls} > div {
	font-size: @tiny;
	text-align: right;
}
@{social-cls} {
	min-height: 20px;  /* Height of G+ and Twitter buttons */
	&:extend(.np);
}
@{cats-and-tags-cls} {
	font-size: @tiny;
	text-align: right;
	&:extend(.np);

	ul {
		display: block;
		list-style: none;
	}
	li {
		display: inline;
		list-style: none;
		margin: 0.5em;
		margin-right: 0;
	}
	li:before {
		content: '» ';
	}
	li:after {
		content: ' ';
	}
	@media screen, projection, tv, handheld {
		p {
			/* Hide ‘In categories’ and ‘Tagged with:’
			   introductions. */
			display: none;
		}
		ul:first-child {
			/* Hide permlink */
			display: none;
		}
	}
}

/* Pagination table */
@{pagination-cls} {
	width: 100%;
	box-sizing: border-box;
	display: table;
	table-layout: fixed;
	margin: 1em 0;
	&:extend(.np);

	ul {
		display: table-row;
	}
	li {
		display: table-cell;
	}
}


/**** Sidebar ****/

@{side-id} {
	a, a:link, a:visited {
		color: #009;
	}
	a:hover, a:focus, a:active {
		color: #069;
	}

	h1 {
		display: none;
	}

	h2 {
		font-size: @large;
		text-align: center;
		margin-bottom: 1em;
	}

	ul, li {
		list-style: none;
	}
}

/* Contact */
@{contact-id} {
	margin-top: 0;

	h2 {
		display: none;
	}
	ul {
		display: block;
	}
	li {
		display: block;
		text-align: center;
		margin: .5em 0;
		line-height: 1.2;
	}
	li:first-child {
		font-weight: bold;
		margin: 1em 0;
	}
}

/* Categories */
@{categories-id} {
	ul {
		display: table;
		width: 100%;
	}
	li {
		display: table-row;
	}
	a {
		display: table-cell;
		padding: 0.2em 0;
	}
	small {
		display: table-cell;
		text-align: right;
		font-size: @tiny;
		padding: 0 0.5em;
		color: #555;
	}
	&:extend(.np);
}
@{feed-icon-cls} {
	width: 16px;
	span {
		display: block;
		background-position: 0px -25px;
		width: 16px;
		height: 16px;
		.grayscale-on();
		.text-off-screen();
	}
	&:hover span, &:focus span, &:active span {
		.grayscale-off();
	}
}

/* Icons */
@{icons-id} {
	ul, li {
		display: block;
		margin: 0 auto;
		text-align: center;
		white-space: nowrap;
	}
	li {
		display: inline-block;
		margin: 0 2px;
	}
	a {
		display: inline-block;
		width: 24px;
		height: 24px;
		.grayscale-on();
		.text-off-screen();
		&:hover, &:focus, &:active {
			.grayscale-off();
		}
	}

	/* FSF */
	li:nth-child(1) a { background-position: -16px -22px; }
	/* FSFE */
	li:nth-child(2) a { background-position:   5px   0px; }
	/* FSFE Fellowship */
	li:nth-child(3) a { background-position: -45px   0px; }
	/* Conservancy */
	li:nth-child(4) a { background-position: -20px   0px; }

	&:extend(.np);
}


/**** Footer ****/

@{foot-id} {
	color: #999;
	background: @head-bg;
	border-top: 1px dotted #ddf;
	font-size: @tiny;
	padding: 1em 0;
	text-align: center;

	a, a:link, a:visited, a:hover, a:active, a:focus {
		color: #9bc;
	}

	@media print {
		margin-top: 4em;
	}
}

/* GitHub octocat corner https://github.com/tholman/github-corners
   Copyright (c) 2016 Tim Holman

   Permission is hereby granted, free of charge, to any person obtaining a copy
   of this software and associated documentation files (the "Software"), to deal
   in the Software without restriction, including without limitation the rights
   to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
   copies of the Software, and to permit persons to whom the Software is
   furnished to do so, subject to the following conditions:

   The above copyright notice and this permission notice shall be included in
   all copies or substantial portions of the Software.

   THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
   IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
   AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
   LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
   OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
   SOFTWARE. */

@{octo-id} {
	position: absolute;
	top: 0;
	border: 0;
	left: 0;
	@media (max-width: (@wrap-width + @octo-width)) {
		display: none;
	}
}
@{octo-id} svg {
	width: @octo-width;
	height: @octo-width;
	@media (max-width: (@wrap-width + 2 * @octo-width)) {
		width: (@octo-width / 2);
		height: (@octo-width / 2);
	}
}
@{octo-id} path {
	fill: #003496;
}
@{octo-id} @{octo-bg-cls} {
	fill: @body-bg;
}
@{octo-id}:hover @{octo-arm-cls} {
	-webkit-transform-origin: 118px 106px;
	transform-origin: 118px 106px;
	animation: octocat-wave 560ms ease-in-out;
}
@keyframes octocat-wave {
	0%, 100% {
		transform: rotate(0);
	}
	20%, 60% {
		transform: rotate(25deg);
	}
	40%, 80% {
		transform: rotate(-8deg);
	}
}

/**** Print ****/

@media print {
	body, html {
		color: #000;
		background: #fff;
	}

	a, a:link, a:visited, a:hover, a:focus, a:active {
		text-decoration: none !important;
		border: none !important;
		color: inherit !important;
	}

	a:after {
		color: #333 !important;
		font-weight: normal;
		font-size: @tiny;
	}

	@{article-text-cls}, @{meta-cls} {
		a[href^="http://"]:after, a[href^="https://"]:after {
			content: " 〈" attr(href) "〉";
		}
		a[href^="/"]:after {
			content: " 〈mina86.com" attr(href) "〉";
		}
	}

	article h1 a[href^="/"]:after {
		content: "\a〈mina86.com" attr(href) "〉";
		white-space: pre-wrap;
	}
}

@{meta-cls} > ul li + li, .np {
	@media print {
		display: none !important;
	}
}


/**** Generic stuff ****/

@{right-align-cls} {
	text-align: right;
}

.nb {
	white-space: nowrap;
}
