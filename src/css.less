/*!github.com/mina86/mina86.com*/

/*
 * Classes:
 * - table.tb – add top and bottom border to each of table’s TBODY.
 * - .rht – align text in element right.
 * - .nb – no break
 * - .np – no print
 * - p.nt – a note with some meta information (special licensing information,
 *   note about series, etc.)  Set with smaller font.
 * - p.ig – an image at the top of some posts (most notably news articles) and
 *   attribution that follows it (two separate paragraphs which *must* follow
 *   each other).
 */

/* I need something which will automatically choose IDs and classes. */
/* id:        d e   g     j k       o p q r   t u v w x y z */
/* cls: a   c   e     h   j k l m   o     r     u v   x y z */

@head-id: #h;  /* Page header. */
@body-id: #b;  /* Page body (article text, comments, sidebar etc). */
@foot-id: #f;  /* Page footer. */

@main-id: #m;  /* Article, comments etc.  In other words, body sans sidebar. */
@side-id: #s;  /* Sidebar. */

@wrap-cls: .w;  /* Wrapper DIV inside @head-id and @body-id elements which exists
                  to limit the ‘usable’ width. */

/* Header elements: */
/* Last links in header which are hidden when side bar is on the side. */
@hidden-links-cls: .d;

/* Main content elements: */
@pagination-cls: .p;  /* Pagination table. */
@pagination-next-cls: .n;  /* Right-hand side link in pagination table. */
@qed-cls: .q;  /* Article is shown in its entirety. */
@byline-cls: .b;  /* Byline paragraph. */
@article-text-cls: .t;  /* Text of the article. */
@comments-id: #c;  /* Comments  (on pages which have comments). */

@meta-cls: .g;
@social-cls: .s;
@cats-and-tags-cls: .i;

/* Sidebar sections: */
@contact-id: #n;  /* Contact section in the sidebar. */
@categories-id: #l;  /* Categories section in the sidebar. */
@archive-id: #a;  /* Archive section in the sidebar. */
@feed-icon-cls: .f;  /* Class for the feed icon */
@icons-id: #i;  /* Icons section at the bottom of the sidebar. */

/* http://spencermortensen.com/articles/typographic-scale/
   ratio = 2, notes = 5 */
@tiny:     round(pow(2rem, -0.4), 2);
@small:    round(pow(2rem, -0.2), 2);
@normal:   1.00rem;
/*         one skipped */
@large:    round(pow(2rem,  0.4), 2);
/*         one skipped */
@huge:     round(pow(2rem,  0.8), 2);
@title:    2.00rem;

@cosmic-latte: #fff8e7;  /* https://en.wikipedia.org/wiki/Cosmic_latte */
@milky-way: #f9f1ff;  /* http://www.news.pitt.edu/milkywaycolor */

// @header-bg: #0844a2;  /* Average of /d/top-img.jpg */
// @bg: @cosmic-latte;
// @even-bg: @milky-way;
// @sidebar-bg: #fff;
// @footer-bg: @header-bg;
// @pre-bg: desaturate(@bg, 100%);

/* http://davidjohnstone.net/pages/lch-lab-colour-gradient-picker is quite
   useful. */

@head-bg: #0844a2;  /* Average colour of /d/top-img.jpg */
@body-bg: #e4f0ff;  /* L* = 95, same a* and b* as @head-bg */
@side-bg: #b6ccee;  /* Step between @head-bg and @body-bg. */
@pre-bg:  #f1f1f1;  /* c = 0, same L* and h as @body-bg */

@text-color: #333333;  /* L* = 20 */
@code-color: #004a17;  /* L* = 20 */


/* Regarding body-font:

   Georgia vs Utopia:
   - Utopia is a bit narrower.  This is good for headings but for body text
     I think I prefer Georgia’s metrics especially since they end up matching
     code font better.
   - Both have two-storey ‘g’ except Georgia uses one-storey ‘g’ in italic
     variant which I think is better.
   - Both have two-storey ‘a’ in roman and one-storey ‘a’ in italic.
   - Sadly, none extend ‘Q’ under following character.
   - Otherwise very similar fonts.
   - Utopia lacks old-style figures.

   Georgia vs Charter:
   - Charter extends ‘Q’ under following character in italic. It’s rather
     subtle though and only in italic, so I’m not that impressed.
   - It’s thinner and narrower which ends up being fine.
   - Similarly to Utopia, Charter has two-storey ‘g’ even in italic and
     two-storey ‘a’ in roman and one-story in italic.
   - Charter lacks old-style figures.

   So I’d say Charter > Utopia but because Charter doesn’t have old-style
   figures, Georgia > Charter.  This should cover virtually all users.

   Linux Libertine:
   - Has old and lining numerals.  Lining are the default.
   - Two-storey ‘a’ and ‘g’ in roman.  In italic only ‘a’ is one-storey but it
     looks somewhat better than in other fonts IMO.
   - Smallest than all other serif fonts which I think is disadvantage for web.
   - ‘Q’ in ‘Qu’ extends under the ‘u’ but that happens only in that pair.
   - ‘M’ with non-parallel legs and the middle almost touching the base line.
     Neither I like.
   - Has the typical f* ligatures.

   Georgia vs Merriweather:
   - Both have old-style figures.
   - Both have two-storey ‘g’ and ‘a’ in roman and one-storey in italic.
   - Regular Merriweather is bolder than Georgia and I think it’s better for
     web.  Surprisingly, bold versions of both have the same width.
   - Merriweather has M with non-parallel legs which I don’t like.  It looks
     especially bad in acronyms.
   - Merriweather being a bit bolder ends up matching code-font better.
   - Requires web fonts.
   - Merriweather’s ‘Q’ extends under following character.  Sadly only in roman.
     Even worse, it happens even if the following character has a descendent so
     ‘Qy’ looks bad.
   - Merriweather doesn’t have ligatures.

   I’d probably use Merriweather but its status is a bit weird.  Its site
   advertises a pro version but it’s nowhere to be found.  Meanwhile, the free
   version apparently doesn’t even have kerning.

   Heuristica:
   - Based on Utopia but with better kerning.
   - Has old style numerals.
   - Two-storey ‘g’ in roman and italic.
   - Two-storey ‘a’ in roman, one-storey in italic.
   - Has automatic ligatures (at least ‘fi’).

   No other free(ish) font that I could find has old-style numerals.  There was
   one (whose name I cannot recommend but started in C) which had old-style
   numerals but only one of it’s styles was free.  I didn’t consider it so much
   better over Georgia to be worth paying for.

   Quickly about other serif fonts:
   - Free Serif is small for some reason.  It has an alternative ‘Q’ in italic
     though witch extends under following character which is actually pretty
     gorgeous.  It doesn’t have old-style numerals.
   - Noto Serif and DejaVu Serif are very similar.  Nothing really special about
     them. */

/* Sans serif fonts:

   Fira Sans:
   - ‘I’, ‘l’ and ‘1’ have different glyphs but ‘I’ and ‘l’ are somehow close in
     appearance. ‘I’ doesn’t have serifs but ‘l’ has a small serif protruding to
     the lift.
   - Underscores are joined.
   - Has slashed zero.  But it’s broken, see
     https://github.com/mozilla/Fira/issues/187
   - Has old style figures.
   - Has ‘M’ with slanted legs.

   Open Sans:
   - ‘I’ and ‘l’ look the same.
   - ‘1’ has no base.
   - Two-storey ‘g’ and ‘a’.
   - The middle ‘V’ in ‘M’ touches baseline creating a lot of needless empty
     space above it.

   Noto Sans:
   - ‘I’, ‘l’ and ‘1’ are easy to distinguish. ‘I’ has serifs, ‘l’ has none; ‘1’
     has base.
   - One-storey ‘g’ and two-storey ‘a’.
   - Kerning feels off. E.g. too much spacing on both sides of ‘M’ in ‘OMP’.
   - Symbols (e.g. parens) are somewhat bigger than in other fonts which is
     nice.
   - The middle ‘V’ in ‘M’ touches baseline creating a lot of needless empty
     space above it.

   Verdana:
   - ‘I’, ‘l’ and ‘1’ are easy to distinguish. ‘I’ has serifs, ‘l’ has none and
     ‘1’ has no base.
   - Wider spaces, underscores and general spacing between characters compared
     to all other fonts except for Input Sans.
   - It’s also marginally bolder, but that I would rather consider
     a disadvantage.
   - Underscores join.
   - Almost universally present on systems.

   Geneva:
   - ‘I’ and ‘l’ without serifs; hard to distinguish. ‘1’ has no base.
   - Underscores don’t join.

   DejaVu Sans:
   - ‘I’ and ‘l’ without serifs; hard to distinguish. ‘1’ has no base.
   - Underscores join.
   - Kerning feels off.  E.g. in ‘me’.

   Liberation Sans:
   - ‘I’ and ‘l’ are identical.
   - Underscores are joined.
   - Two-storey ‘g’ (with an open loop).
   - ‘ti’ are too close to each other.

   Lucida Sans, Lucida Grande and Lucida Sans Unicode:
   - ‘I’ and ‘l’ look the same.
   - Underscores aren’t connected but that’s hard to see at small sizes.
   - LSU ‘1’ with a base and longer thingy at the top (whatever it is called)
     compared to other Lucidas.
   - Kerning in LS and LSU looks worse, than in LG, for ‘ci’ pair for example.
   - LSU has some glyphs — like dash, pipe, solidus, etc — a tiny bit bolder
     which I like more.
   - Overall: LSU > LG > LS.
   - The middle ‘V’ in ‘M’ touches baseline creating a lot of needless empty
     space above it.

   Input Sans:
   - ‘I‘, ‘l’ and ‘1’ very easy to distinguish.  ‘I’ has serifs, ‘1’ has base.
   - Hes stroked zero.
   - Underscores don’t connect.
   - Input is maybe even too wide.  Input Sans Narrow might be a better choice.
     It is still wider than Verdana but not by a lot.
   - Closing curly brace actually feels ‘too fancy’ for a sans-serif font.
   - {Regular, Bold} {Roman, Italic} (total of four styles) ends up 10 USD per
     year which is more than what I’m paying for hosting.  At this moment I’m
     not convinced this is worth it. */

@body-font: /* Merriweather, */ Georgia, Charter, Utopia, serif;
@code-font: 'Input Sans Narrow', Verdana, sans-serif;
@head-font: 'DejaVu Sans', Verdana, sans-serif;
@headers-font: 'Linux Libertine', @body-font;
@sidebar-width: 14em;
@content-width: 50em;
@wrap-width: (@sidebar-width + @content-width);


.text-off-screen() {
	text-indent: 100%;
	white-space: nowrap;
	overflow: hidden;
}


* {
	box-sizing: border-box;
	margin: 0;
	padding: 0;
}


html, body {
	@media screen, projection, tv, handheld {
		color: @text-color;
		background: @body-bg;
	}
	font-family: @body-font;
	font-feature-settings: 'onum', 'pnum';
	font-variant-numeric: oldstyle-nums proportional-nums;
	text-rendering: optimizelegibility;
	line-height: 1.5em;
}


/**** Page layout ****/

@media screen, projection, tv, handheld {
	html {
		height: 100%;
	}
	body {
		display: flex;
		flex-direction: column;
		min-height: 100%;
	}
	@{body-id} {
		flex: 1;
	}

	@{head-id} {
		height: 14em;
	}
	@{head-id} @{wrap-cls} {
		height: 100%;
	}

	@{main-id}, @{side-id} section {
		padding: 1em;
		max-width: @content-width;
		margin: 0 auto;
	}
	@{side-id} {
		padding-top: 1em;
		padding-bottom: 5em;
	}

	/* Annoyingly, this rule has to be specified here because if it goes
	   below where other sidebar rules are, the ‘background: none’ property
	   in @media just below won’t clear it. */

	@{side-id} {
		background: @side-bg;
	}

	@media (min-width: @wrap-width) {
		@{wrap-cls} {
			min-width: @wrap-width;
			width: 90%;
			max-width: (@wrap-width + 5em);
			margin: 0 auto;
		}

		@{main-id} {
			float: left;
			width: @content-width;
			max-width: @content-width;
		}

		@{main-id} @{wrap-cls} {
			padding: 0;
		}

		@{side-id} {
			float: right;
			width: @sidebar-width;
			background: none;
			padding: 0;
		}

		@{side-id} section {
			padding: 1em 0.5em;
		}

		@{body-id} {
			overflow: auto;
			padding-bottom: 5em;
		}

		/* Sticking those here helps with minification: */
		@{contact-id} li:first-child span { display: block; }
		@{head-id} li@{hidden-links-cls} { display: none; }
	}
}

/**** Links ****/

h1, h2, h3 {
	page-break-after: avoid;
	a, a:link, a:hover, a:active, a:focus, a:visited {
		color: inherit;
	}
}

a {
	text-decoration: none;
	color: #00f;
}
a:visited {
	color: #63c;
}
a:hover, a:focus, a:active {
	color: #09f;
	text-decoration: underline;
}


/**** Page header ****/

@{head-id} {
	background: @head-bg;
	font-family: @head-font;

	h1 {
		font-size: @title;
	}
	h1 span {
		font-variant: small-caps;
	}

	@media screen, projection, tv, handheld {
		background: @head-bg url(/d/top-img.jpg) no-repeat;
		background-size: cover;
		/* filter: brightness(1.2) blur(5px); */

		@{wrap-cls} {
			position: relative;
		}

		h1 {
			position: absolute;
			color: @body-bg;
			top: 20%;
			left: 2%;
		}

		nav {
			position: absolute;
			bottom: 20%;
			left: 2%;
		}

		li {
			display: inline-block;
			margin: 0.2em;
		}

		ul a, ul a:link, ul a:visited {
			display: inline-block;
			padding: 0.5em 1em;
			color: #333;
			font-weight: 700;
			white-space: nowrap;
			background: #fff;
			background: rgba(255, 255, 255, 0.5);
			text-decoration: none;
			border-radius: 0.3em;
		}

		ul a:hover, ul a:active, ul a:focus {
			color: #00f;
			background: rgba(255, 255, 255, 0.4);
			background: -o-linear-gradient(bottom, #cff, rgba(255, 255, 255, 0.4));
			background: -moz-linear-gradient(bottom, #cff, rgba(255, 255, 255, 0.4));
			background: -webkit-linear-gradient(bottom, #cff, rgba(255, 255, 255, 0.4));
			text-shadow: #000 0.5em 0.5em 1em;
		}

		/* Google Search */
		#___gcse_0 {
			position: absolute;
			top: 1em;
			right: 0;
			width: 50%;
			* {
				box-sizing: content-box;
			}
		}
		.cse .gsc-control-cse,
		.gsc-control-cse,
		form.gsc-search-box,
		table.gsc-search-box {
			background: transparent;
			border: none;
			padding: 0;
			margin: 0;
		}
	}

	nav, #___gcse_0 {
		&:extend(.np);
	}
}


/**** Main content, text of the article and such ****/

article {
	padding: 2em 0;
	position: relative;

	& + &:before {
		content: '';
		position: absolute;
		top: 0;
		left: 15%;
		width: 70%;
		height: 1px;
		border-top: 1px solid mix(@body-bg, #000, 80%);
	}

	p, dd, li {
		text-align: justify;
		text-justify: distribute;
		text-justify: newspaper;
		hanging-punctuation: first allow-end last;
		hyphens: auto;
	}

	p {
		margin: 1rem 0;
	}

	@media screen, projection, tv, handheld {
		text-shadow: 1px 1px 0 #D9D9E6;;
	}
}

/* Links */
@{article-text-cls} {
	a {
		border-bottom: 1px dotted #99f;
	}

	a:hover, a:focus, a:active {
		text-decoration: none;
		border-bottom-style: solid;
		borter-bottom-color: #09f;
	}
}

/* Headers */
article {
	h1, h2, h3 {
		font-family: @headers-font;
		margin: 1rem 0;
		a, a:hover, a:focus, a:active {
			border: none;
		}
	}
	h1 {
		font-size: @huge;
		margin-top: 0;
	}
	h2 {
		font-size: @large;
		margin-top: 2rem;
	}
	h3 {
		font-size: @normal;
	}
}

/* Byline etc */
p@{byline-cls} {
	font-style: italic;
	font-weight: 300;
	color: #666;
	page-break-before: avoid;
	page-break-after: avoid;

	em {
		font-weight: bold;
	}
}

p.nt {
	font-size: @tiny;
	margin-left: 30%;
	text-align: left;
	hyphens: manual;
	font-style: italic;
}

p.ig, figure {
	text-align: center;
	img {
		max-width: 100%;
		height: auto;
	}
}
p.ig + p.ig {
	text-align: right;
	margin-top: -1em;
	font-size: @tiny;
	page-break-before: avoid;
}

/* Code */
pre, code, kbd {
	font-family: @code-font;
	font-feature-settings: 'lnum', 'zero';
	font-variant-numeric: lining-nums slashed-zero;
	color: @code-color;
	text-shadow: none;
	page-break-inside: avoid;
}
pre {
	@media screen, projection, tv, handheld {
		background: @pre-bg;
	}
	margin: 1em 0;
	padding: .5em 1em;
	border-top: 1px dotted #363;
	border-bottom: 1px dotted #363;
	overflow-x: auto;
	font-size: @small;
}
code, var {
	hyphens: manual;
}

@media screen, projection, tv, handheld {
	pre b, pre var {
		text-shadow: 1px 1px 0 #cec;
	}

	@{qed-cls} @{article-text-cls} > p:last-child:after {
		color: #999;
		font-size: @tiny;
		content: ' -30-';
	}
}

/* Lists */
@{article-text-cls} {
	ul, ol, dl {
		margin: 1em 0;
	}
	li {
		margin: 0 0 0 2em;
		/* Less' data-uri is way over-zealous when URL encoding data
		   URIs which is why I’m sticking to my own. */
		list-style: url(DATA<dot.svg>);
	}
	dt, dd {
		padding: 0;
		margin-top: .25em;
	}
	dd {
		margin-left: 1.59em;
	}
	dd + dt {
		margin-top: 1em;
	}
}

/* Tables */
/* Putting this outside of @{article-text-cls} breaks Google custom search
   whose layout is based on tables.  *sighs* */
@{article-text-cls} {
	table, tr, th, td {
		font-variant-numeric: lining-nums tabular-nums;
		border-collapse: collapse;
	}
	th, td {
		padding: 0.5em;
	}
	thead th, thead td {
		padding: 0.2em 0.5em;
	}
	table {
		margin: 1em auto;
	}
	thead, .tb tbody, tfoot {
		border-top: 1px solid #000;
		border-bottom: 1px solid #000;
	}
	.tb tbody:last-child {
		border: none;
	}
}

/* Misc */
blockquote {
	background: url(/d/t.png) no-repeat;
	background-position: -125px 0;
	min-height: 20px;
	padding: 0 30px;
	margin: 1em;
	font-size: @small;
}

.plFlag, .enFlag {
	background: url(/d/t.png) no-repeat;
	/* That’s for .enFlag, .plFlag will override it below.  Sticking it here helps
	   with minification. */
	background-position: -100px -25px;
	text-indent: 22px;
}

.plFlag {
	background-position: -75px -50px;
}

/* Meta information, social etc. */
@{meta-cls} {
	overflow: auto;
	page-break-inside: avoid;
	margin: 1em 0;
	font-style: italic;
}
@{meta-cls} > ul {
	margin: 1em 0;
	float: left;
}
@{meta-cls} > div {
	font-size: @tiny;
	text-align: right;
}
@{social-cls} {
	margin-top: 1em;
	min-height: 20px;  /* Height of G+ and Twitter buttons */
	&:extend(.np);
}
@{cats-and-tags-cls} {
	font-size: @tiny;
	text-align: right;
	&:extend(.np);

	ul {
		display: block;
		list-style: none;
	}
	li {
		display: inline;
		list-style: none;
		margin: 0.5em;
		margin-right: 0;
	}
	li:before {
		content: '» ';
	}
	li:after {
		content: ' ';
	}
	@media screen, projection, tv, handheld {
		p {
			/* Hide ‘In categories’ and ‘Tagged with:’
			   introductions. */
			display: none;
		}
		ul:first-child {
			/* Hide permlink */
			display: none;
		}
	}
}

/* Pagination table */
@{pagination-cls} {
	width: 100%;
	box-sizing: border-box;
	display: table;
	table-layout: fixed;
	margin: 1em 0;
	&:extend(.np);

	ul {
		display: table-row;
	}
	li {
		display: table-cell;
	}
}
@{pagination-next-cls} {
	text-align: right;
}


/**** Sidebar ****/

@{side-id} {
	a, a:link, a:visited {
		color: #009;
	}
	a:hover, a:focus, a:active {
		color: #069;
	}

	h1 {
		display: none;
	}

	h2 {
		font-size: @large;
		text-align: center;
		margin-bottom: 1em;
	}

	ul, li {
		list-style: none;
	}
}

/* Contact */
@{contact-id} {
	margin-top: 0;

	h2 {
		display: none;
	}
	ul {
		display: block;
	}
	li {
		display: block;
		text-align: center;
		margin: .5em 0;
		line-height: 1.2;
	}
	li:first-child {
		font-weight: bold;
		margin: 1em 0;
	}
}

/* Categories and archive */
@{categories-id}, @{archive-id} {
	ul {
		display: table;
		width: 100%;
	}
	li {
		display: table-row;
	}
	a {
		display: table-cell;
		padding: 0.2em 0;
	}
	small {
		display: table-cell;
		text-align: right;
		font-size: @tiny;
		padding: 0 0.5em;
		color: #555;
	}
	&:extend(.np);
}
@{feed-icon-cls} {
	width: 16px;
}
@{feed-icon-cls} span {
	background: url(/d/t.png) no-repeat;
	display: block;
	background-position: -25px -50px;
	width: 16px;
	height: 16px;
	.text-off-screen();
}

/* Icons */
@{icons-id} {
	ul, li {
		display: block;
		margin: 0 auto;
		text-align: center;
		white-space: nowrap;
	}
	li {
		display: inline-block;
		margin: 0 2px;
	}
	a {
		display: inline-block;
		width: 24px;
		height: 24px;
	}

	a {
		background: url(/d/t.png) no-repeat;
		.text-off-screen();
	}

	/* FSF */
	li:nth-child(1) a       { background-position: -100px  0px; }
	li:nth-child(1) a:hover { background-position: -50px -50px; }
	/* FSFE */
	li:nth-child(2) a       { background-position: -50px   0px; }
	li:nth-child(2) a:hover { background-position: -50px -25px; }
	/* FSFE Fellowship */
	li:nth-child(3) a       { background-position: -25px   0px; }
	li:nth-child(3) a:hover { background-position: -25px -25px; }
	/* Conservancy */
	li:nth-child(4) a       { background-position:   0px   0px; }
	li:nth-child(4) a:hover { background-position:   0px -25px; }
	/* Slackware */
	li:nth-child(5) a       { background-position: -75px   0px; }
	li:nth-child(5) a:hover { background-position: -75px -25px; }

	&:extend(.np);
}


/**** Footer ****/

@{foot-id} {
	color: #999;
	background: @head-bg;
	border-top: 1px dotted #ddf;
	font-size: @tiny;
	padding: 1em 0;
	text-align: center;

	a, a:link, a:visited, a:hover, a:active, a:focus {
		color: #9bc;
	}

	@media print {
		margin-top: 4em;
	}
}


/**** Print ****/

@media print {
	body, html {
		color: #000;
		background: #fff;
	}

	a, a:link, a:visited, a:hover, a:focus, a:active {
		text-decoration: none !important;
		border: none !important;
		color: inherit !important;
	}

	a:after {
		color: #333 !important;
		font-weight: normal;
		font-size: @tiny;
	}

	@{article-text-cls}, @{meta-cls} {
		a[href^="http://"]:after, a[href^="https://"]:after {
			content: " 〈" attr(href) "〉";
		}
		a[href^="/"]:after {
			content: " 〈mina86.com" attr(href) "〉";
		}
	}

	article h1 a[href^="/"]:after {
		content: "\a〈mina86.com" attr(href) "〉";
		white-space: pre-wrap;
	}
}

@{meta-cls} > ul li + li, .np {
	@media print {
		display: none !important;
	}
}


/**** Generic stuff ****/

.rht {
	text-align: right;
}

.nb {
	white-space: nowrap;
}
